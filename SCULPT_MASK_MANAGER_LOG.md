# Sculpt Mask Manager 开发日志

## 版本历史

### v1.0.0 (Extension System Release) - 2026-01-17
- **Blender 4.2+ 扩展系统适配**: 
    - 将单文件插件重构为文件夹包结构。
    - 增加 `blender_manifest.toml` 清单文件，符合官方扩展平台标准。
    - 移除了旧版的 `bl_info` 元数据管理方式。
- **结构优化**:
    - 核心逻辑整合至 `__init__.py`。
    - 增加 `README.md` 说明文档。
- **清理**: 删除了冗余的单文件 `sculpt_mask_manager.py`。

### v1.6.0
- **智能轴向投影 (Smart Axis Projection)**: 
    - 自动分析遮罩顶点的空间分布，选择跨度最大的两个轴作为投影平面（XY/XZ/YZ）。
    - 解决了侧面或顶部遮罩在缩略图中显示为“一条线”的问题。
- **等比缩放与居中**: 
    - 优化了缩略图映射算法，确保物体轮廓在 128x128 预览图中等比缩放并自动居中，防止拉伸变形。
- **UI 预览增强**: 
    - 提高了基础轮廓的可见度，使遮罩区域与物体形状的相对位置更清晰。
- **Bug 修复**:
    - 修复了在 Blender 5.0 中 `Image` 对象缺少 `asset_generate` 属性导致的报错，改用更稳定的 `preview_ensure()` 方法生成 UI 图标。

### v1.5
- **离屏快照系统**: 实现保存遮罩时自动捕获物体遮罩状态的缩略图。
- **零垃圾存储**: 缩略图以隐藏 Image 数据块形式存储并打包在 `.blend` 中。
- **图标集成**: 饼状菜单和侧边栏列表现在显示遮罩预览图。

### v1.4
- **全量列表**: 饼状菜单 (Pie Menu) 现在支持列出所有已保存的遮罩组。
- **内存级快照架构**: 
    - 采用内存缓存方案，预览图仅存在于内存和 `.blend` 文件中，不产生系统垃圾。
    - 奠定了缩略图生成的架构基础。
- **快捷组合键交互**:
    - `点击`: 替换 (REPLACE)
    - `Shift + 点击`: 相加 (ADD)
    - `Ctrl + 点击`: 相减 (SUB)
    - `Alt + 点击`: 相乘 (MUL)
- **UI 优化**: 饼状菜单布局重构，增加操作提示。

### v1.3
- **全局混合模式**: 引入插件全局混合模式设置。
- **NumPy 加速**: 优化了百万级面数下的读写性能。
- **UI 注入**: 增加了顶部标题栏 (Header) 的 Popover 菜单。
- **快捷键**: 注册 `Alt + M` 呼出饼状菜单。

### v1.1 - v1.2
- **基础功能**: 实现遮罩保存为顶点组（前缀 `MSK_`）。
- **API 适配**: 适配 Blender 4.0/5.0 的 `.sculpt_mask` 属性系统。

---

## 用户确认的修改点
- [x] 预览图存储方案：采用内存级存储，确保零系统垃圾。
- [x] 交互方案：使用 Shift/Ctrl/Alt 组合键直接在点击时决定混合模式。
- [x] 记录机制：建立此开发日志文件。
